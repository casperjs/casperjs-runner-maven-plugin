language: java

jdk:
  - openjdk6
  - openjdk7
  - oraclejdk7
  - oraclejdk8

before_install:
  - wget https://phantomjs.googlecode.com/files/phantomjs-1.8.2-linux-x86_64.tar.bz2
  - wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-1.9.7-linux-x86_64.tar.bz2
  - wget https://github.com/n1k0/casperjs/archive/1.0.4.tar.gz -O casperjs-1.0.4.tar.gz
  - wget https://github.com/n1k0/casperjs/archive/1.1-beta3.tar.gz -O casperjs-1.1-beta3.tar.gz

install:
  - tar jxf phantomjs-1.8.2-linux-x86_64.tar.bz2
  - tar jxf phantomjs-1.9.7-linux-x86_64.tar.bz2
  - tar zxf casperjs-1.0.4.tar.gz
  - tar zxf casperjs-1.1-beta3.tar.gz

before_script:
  - export PATH=$(pwd)/casperjs-1.1-beta3/bin:$(pwd)/phantomjs-1.9.7-linux-x86_64/bin:$PATH
  - echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
          <toolchains>
            <toolchain>
              <type>casperjs</type>
              <provides> <version>1.0.4</version> </provides>
              <configuration><casperjsExecutable>$(pwd)/casperjs-1.0.4/bin/casperjs</casperjsExecutable></configuration>
            </toolchain>
            <toolchain>
              <type>casperjs</type>
              <provides> <version>1.1.0</version> </provides>
              <configuration><casperjsExecutable>$(pwd)/casperjs-1.1-beta3/bin/casperjs</casperjsExecutable></configuration>
            </toolchain>
          </toolchains>" > ~/.m2/toolchains.xml
  - echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
          <settings xmlns=\"http://maven.apache.org/SETTINGS/1.0.0\" 
              xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" 
              xsi:schemaLocation=\"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd\">
            <profiles>
              <profile>
                <id>casperjs</id>
                <activation>
                  <activeByDefault>true</activeByDefault>
                </activation>
                <properties>
                  <casperjs-default-path>$(pwd)/casperjs-1.1-beta3/bin</casperjs-default-path>
                  <phantomjs-for-casper-1.0-path>$(pwd)/phantomjs-1.8.2-linux-x86_64/bin</phantomjs-for-casper-1.0-path>
                  <phantomjs-for-casper-1.1-path>$(pwd)/phantomjs-1.9.7-linux-x86_64/bin</phantomjs-for-casper-1.1-path>
                </properties>
              </profile>
            </profiles>
          </settings>" > settings.xml

script:
  - phantomjs --version
  - casperjs --version
  - mvn --settings settings.xml -Pit install

after_script:
  - find -name build.log -exec cat {} \;
